---
import "../styles/global.css";
/* animations.css removed - consolidated into global.css (DRY principle) */
import { ClientRouter } from "astro:transitions";
import Navbar from "../components/NavbarAstro.astro";
import Footer from "../components/Footer.astro";
import WhatsAppWidget from "../components/WhatsAppWidget.astro";
import { createBreadcrumbSchemaFromUrl } from "../utils/schema";

// Props individuales
let {
  title,
  description,
  keywords,
  image,
  article,
  noindex,
  author,
  publishedTime,
  tags,
  categories,
  breadcrumbNames,
  canonicalOverride,
} = Astro.props;

// Valores por defecto mejorados
title =
  title ||
  "Codebrand - Digital Agency | Web Development, Automations, Design & Marketing";
description =
  description ||
  "Transform your business with Codebrand's expert web development, UI/UX design, and digital marketing services. Get custom solutions that drive real results. Contact us for a free consultation.";
keywords =
  keywords ||
  "web development agency, UI/UX design services, digital marketing agency, custom web development, mobile app development, SEO optimization, social media marketing, branding agency, e-commerce development, graphic design services";
image = image || "https://codebrand.us/photos/bannercodebrand.webp";

// URL dinámica y mejoras SEO (permite override para páginas duplicadas)
const canonicalUrl =
  canonicalOverride || Astro.url?.href || "https://codebrand.us";
const siteName = "Codebrand Digital Agency";
const twitterHandle = "@codebrand_us";

// Format article dates for Open Graph
let formattedPublishedTime = "";
if (publishedTime) {
  if (publishedTime instanceof Date) {
    formattedPublishedTime = publishedTime.toISOString();
  } else if (typeof publishedTime === "string") {
    const dateObj = new Date(publishedTime);
    if (!isNaN(dateObj.getTime())) {
      formattedPublishedTime = dateObj.toISOString();
    }
  }
}

// Generate dynamic breadcrumbs based on current URL
const breadcrumbSchema = createBreadcrumbSchemaFromUrl(
  canonicalUrl,
  "https://codebrand.us",
  breadcrumbNames || {},
);
---

<!doctype html>
<html lang="en-US">
  <head>
    <!-- Essential Meta Tags -->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- SEO Meta Tags -->
    <title>{title}</title>
    <meta name="description" content={description} />
    <meta name="keywords" content={keywords} />
    <meta name="author" content="Codebrand Digital Agency" />
    <meta name="publisher" content="Codebrand" />

    <meta
      name="robots"
      content={noindex
        ? "noindex, nofollow"
        : "index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"}
    />
    <meta
      name="googlebot"
      content={noindex ? "noindex, nofollow" : "index, follow"}
    />
    <meta
      name="bingbot"
      content={noindex ? "noindex, nofollow" : "index, follow"}
    />

    <!-- Canonical and Alternative URLs -->
    <link rel="canonical" href={canonicalUrl} />
    <!-- hreflang: Primary language is English, x-default for international users -->
    <link rel="alternate" hreflang="en-US" href={canonicalUrl} />
    <link rel="alternate" hreflang="x-default" href={canonicalUrl} />

    <!-- RSS Feed -->
    <link
      rel="alternate"
      type="application/rss+xml"
      title="Codebrand Blog RSS Feed"
      href="/rss.xml"
    />

    <!-- LLM Information for AI Assistants -->
    <link rel="author" href="/llms.txt" />
    <meta
      name="ai-content-declaration"
      content="This website contains information optimized for AI assistants. See /llms.txt for structured data."
    />

    <!-- Theme and Application -->
    <meta name="theme-color" content="#0D9488" />
    <meta name="color-scheme" content="light" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content="Codebrand" />
    <meta name="application-name" content="Codebrand" />
    <meta name="msapplication-TileColor" content="#0D9488" />

    <!-- Open Graph Protocol -->
    <meta property="og:type" content={article ? "article" : "website"} />
    <meta property="og:site_name" content={siteName} />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={image} />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta property="og:image:alt" content={title} />
    <meta property="og:url" content={canonicalUrl} />
    <meta property="og:locale" content="en_US" />
    <meta property="og:locale:alternate" content="es_ES" />
    <meta property="og:locale:alternate" content="es_MX" />
    <meta property="og:locale:alternate" content="es_HN" />

    {
      article && formattedPublishedTime && (
        <>
          <meta
            property="article:published_time"
            content={formattedPublishedTime}
          />
          {author && <meta property="article:author" content={author} />}
          {categories &&
            Array.isArray(categories) &&
            categories.map((cat: string) => (
              <meta property="article:section" content={cat} />
            ))}
          {tags &&
            Array.isArray(tags) &&
            tags.map((tag: string) => (
              <meta property="article:tag" content={tag} />
            ))}
        </>
      )
    }

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content={twitterHandle} />
    <meta name="twitter:creator" content={twitterHandle} />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content={image} />
    <meta name="twitter:image:alt" content={title} />

    <!-- Geo Tags - Primary market US, operations in Honduras -->
    <meta name="geo.region" content="US" />
    <meta name="geo.placename" content="United States" />
    <meta name="geo.position" content="15.5049;-88.0254" />
    <meta name="ICBM" content="15.5049, -88.0254" />

    <!-- Links and Resources -->
    <link rel="sitemap" href="/sitemap-index.xml" />
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="icon" type="image/svg+xml" href="/iconcodebrand.svg" />
    <link rel="apple-touch-icon" sizes="180x180" href="/iconcodebrand.svg" />
    <link rel="manifest" href="/manifest.json" />

    <!-- DNS Prefetch for Performance -->
    <link rel="dns-prefetch" href="https://www.googletagmanager.com" />
    <link rel="dns-prefetch" href="https://analytics.ahrefs.com" />
    <link rel="dns-prefetch" href="https://www.google.com" />
    <link rel="dns-prefetch" href="https://www.gstatic.com" />

    <!-- Preload Critical Resources for LCP optimization -->
    <link
      rel="preload"
      as="image"
      href="/photos/bannercodebrand.webp"
      fetchpriority="high"
    />

    <!-- Resource Hints for better loading -->
    <link rel="prefetch" href="/photos/section.webp" />
    <link rel="prefetch" href="/iconcodebrand.svg" />

    <!-- Preload critical fonts for better LCP -->
    <link rel="preload" href="/fonts/Poppins-Regular.ttf" as="font" type="font/ttf" crossorigin />
    <link rel="preload" href="/fonts/Poppins-SemiBold.ttf" as="font" type="font/ttf" crossorigin />
    <link rel="preload" href="/fonts/Poppins-Bold.ttf" as="font" type="font/ttf" crossorigin />

    <!-- Enhanced Structured Data -->
    <script type="application/ld+json" is:inline>
      {
        "@context": "https://schema.org",
        "@type": "ProfessionalService",
        "name": "Codebrand - Honduras Software Development Agency",
        "alternateName": [
          "Codebrand Solutions",
          "Codebrand Digital Agency",
          "Codebrand Honduras"
        ],
        "url": "https://codebrand.us",
        "logo": "https://codebrand.us/iconcodebrand.svg",
        "image": "https://codebrand.us/photos/bannercodebrand.webp",
        "description": "Modern web development agency helping growing businesses build websites and software that scale. US-quality work, bilingual team, smart pricing. Based in Honduras, serving clients worldwide.",
        "slogan": "Modern Web Development For Growing Businesses",
        "email": "info@codebrand.us",
        "telephone": "+504-3272-2973",
        "foundingDate": "2020",
        "numberOfEmployees": {
          "@type": "QuantitativeValue",
          "value": "25"
        },
        "address": {
          "@type": "PostalAddress",
          "streetAddress": "Calle 4, Avenida 11",
          "addressLocality": "San Pedro Sula",
          "addressRegion": "Cortés",
          "addressCountry": "HN",
          "postalCode": "21102"
        },
        "areaServed": [
          {
            "@type": "Country",
            "name": "United States"
          },
          {
            "@type": "Country",
            "name": "Honduras"
          },
          {
            "@type": "Country",
            "name": "Mexico"
          },
          {
            "@type": "Country",
            "name": "Guatemala"
          },
          {
            "@type": "Country",
            "name": "El Salvador"
          },
          {
            "@type": "Country",
            "name": "Costa Rica"
          },
          {
            "@type": "Country",
            "name": "Panama"
          },
          {
            "@type": "Country",
            "name": "Colombia"
          },
          {
            "@type": "Country",
            "name": "Spain"
          },
          {
            "@type": "Country",
            "name": "Chile"
          }
        ],
        "serviceArea": {
          "@type": "AdministrativeArea",
          "name": "United States and Latin America"
        },
        "priceRange": "$$$",
        "currenciesAccepted": "USD",
        "paymentAccepted": "Credit Card, Bank Transfer, PayPal",
        "openingHours": "Mo-Fr 09:00-18:00",
        "sameAs": [
          "https://www.linkedin.com/company/codebrand-es",
          "https://x.com/Codebrand_es",
          "https://www.facebook.com/p/Codebrand-100087321501519/"
        ],
        "knowsAbout": [
          "Web Development",
          "React Development",
          "Next.js Development",
          "Astro Development",
          "Node.js Development",
          "TypeScript Development",
          "UI/UX Design",
          "Mobile App Development",
          "iOS Development",
          "Android Development",
          "E-commerce Development",
          "Shopify Development",
          "Digital Marketing",
          "SEO Optimization",
          "Landing Page Design",
          "Branding",
          "Social Media Marketing",
          "Video Production",
          "3D Rendering",
          "Nearshore Development",
          "Offshore Development",
          "Software Export Services",
          "Honduras Software Development",
          "Central America Tech Services",
          "Cost-Effective Web Development",
          "Bilingual Software Teams"
        ],
        "knowsLanguage": ["English", "Spanish"],
        "award": [
          "Top Rated Web Development Agency Honduras 2025",
          "500+ Successful International Projects"
        ],
        "hasOfferCatalog": {
          "@type": "OfferCatalog",
          "name": "Software Development Services",
          "itemListElement": [
            {
              "@type": "Offer",
              "itemOffered": {
                "@type": "Service",
                "name": "Custom Web Development",
                "description": "Full-stack web development using React, Next.js, Astro, Node.js, and TypeScript. Professional quality at 60% less than US rates.",
                "provider": {
                  "@type": "Organization",
                  "name": "Codebrand"
                },
                "areaServed": "United States",
                "availableLanguage": ["English", "Spanish"]
              }
            },
            {
              "@type": "Offer",
              "itemOffered": {
                "@type": "Service",
                "name": "Mobile App Development",
                "description": "Native iOS and Android app development with cross-platform solutions using React Native and Flutter.",
                "provider": {
                  "@type": "Organization",
                  "name": "Codebrand"
                },
                "areaServed": "United States"
              }
            },
            {
              "@type": "Offer",
              "itemOffered": {
                "@type": "Service",
                "name": "E-commerce Development",
                "description": "Complete e-commerce solutions with Shopify, WooCommerce, and custom platforms. Payment gateway integration and inventory management.",
                "provider": {
                  "@type": "Organization",
                  "name": "Codebrand"
                },
                "areaServed": "United States"
              }
            },
            {
              "@type": "Offer",
              "itemOffered": {
                "@type": "Service",
                "name": "UI/UX Design Services",
                "description": "User-centered design services including wireframing, prototyping, and high-fidelity mockups using Figma and Adobe Creative Suite.",
                "provider": {
                  "@type": "Organization",
                  "name": "Codebrand"
                }
              }
            },
            {
              "@type": "Offer",
              "itemOffered": {
                "@type": "Service",
                "name": "SEO and Digital Marketing",
                "description": "Comprehensive SEO optimization, content marketing, social media management, and paid advertising campaigns.",
                "provider": {
                  "@type": "Organization",
                  "name": "Codebrand"
                }
              }
            },
            {
              "@type": "Offer",
              "itemOffered": {
                "@type": "Service",
                "name": "Nearshore Software Development",
                "description": "Honduras-based development team serving US businesses with timezone compatibility, bilingual communication, and 60% cost savings.",
                "provider": {
                  "@type": "Organization",
                  "name": "Codebrand"
                },
                "areaServed": "United States"
              }
            }
          ]
        },
        "aggregateRating": {
          "@type": "AggregateRating",
          "ratingValue": "4.9",
          "reviewCount": "127",
          "bestRating": "5",
          "worstRating": "1"
        },
        "brand": {
          "@type": "Brand",
          "name": "Codebrand",
          "slogan": "Export-Quality Software Development from Honduras to USA"
        },
        "employee": [
          {
            "@type": "OrganizationRole",
            "roleName": "Development Team",
            "description": "Certified developers with expertise in Udemy, Platzi, and Adobe certifications"
          }
        ],
        "makesOffer": [
          {
            "@type": "Offer",
            "name": "Free Consultation",
            "description": "Free initial consultation for US businesses seeking cost-effective software development",
            "price": "0",
            "priceCurrency": "USD"
          }
        ]
      }
    </script>

    <!-- Dynamic BreadcrumbList Schema -->
    <script
      type="application/ld+json"
      is:inline
      set:html={JSON.stringify(breadcrumbSchema)}
    />

    <!-- WebSite Schema with Search -->
    <script type="application/ld+json" is:inline>
      {
        "@context": "https://schema.org",
        "@type": "WebSite",
        "name": "Codebrand Digital Agency",
        "url": "https://codebrand.us",
        "potentialAction": {
          "@type": "SearchAction",
          "target": {
            "@type": "EntryPoint",
            "urlTemplate": "https://codebrand.us/search?q={search_term_string}"
          },
          "query-input": "required name=search_term_string"
        }
      }
    </script>

    <!-- Performance Hints -->
    <meta name="format-detection" content="telephone=no" />
    <meta name="skype_toolbar" content="skype_toolbar_parser_compatible" />

    <!-- Google Tag Manager + Analytics - loaded with tracking scripts -->
    <script is:inline>
      window.dataLayer = window.dataLayer || [];
      function gtag() { dataLayer.push(arguments); }
    </script>

    <!-- Enable JS-dependent animations -->
    <script is:inline>
      document.documentElement.classList.add('js-enabled');
    </script>

    <ClientRouter />
  </head>
  <body>
    <!-- Skip to main content link for keyboard/screen reader users -->
    <a
      href="#main-content"
      class="skip-to-content"
    >
      Skip to main content
    </a>

    <!-- Google Tag Manager (noscript) -->
    <noscript
      ><iframe
        src="https://www.googletagmanager.com/ns.html?id=GTM-TJCP2CWN"
        height="0"
        width="0"
        style="display:none;visibility:hidden"></iframe></noscript
    >
    <!-- End Google Tag Manager (noscript) -->

    <Navbar />
    <main id="main-content" tabindex="-1">
      <slot />
    </main>
    <Footer />
    <WhatsAppWidget />

    <!-- Service Worker Registration -->
    <script is:inline>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('/sw.js', { scope: '/' })
            .catch(() => { /* SW registration failed silently */ });
        });
      }
    </script>

    <!-- Deferred Analytics Scripts - Load after page is interactive -->
    <script is:inline>
      // Load all tracking scripts after user interaction or 3 seconds
      function loadTrackingScripts() {
        // Google Tag Manager
        (function(w,d,s,l,i){w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});
        var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';
        j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;
        f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-TJCP2CWN');

        // Google Analytics 4
        var ga=document.createElement('script');ga.async=true;
        ga.src='https://www.googletagmanager.com/gtag/js?id=G-T9HKBF45M9';
        document.head.appendChild(ga);
        gtag('js',new Date());gtag('config','G-T9HKBF45M9');

        // Meta Pixel (Facebook)
        !function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?
        n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;
        n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;
        t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,
        document,'script','https://connect.facebook.net/en_US/fbevents.js');
        fbq('init','823190717423799');fbq('track','PageView');

        // Ahrefs Analytics
        var s=document.createElement('script');s.async=true;
        s.src='https://analytics.ahrefs.com/analytics.js';
        s.setAttribute('data-key','JekMc+iUh7qv8b6i7VSQFw');
        document.head.appendChild(s);
      }

      // Load tracking after first user interaction OR after 4 seconds (mobile-friendly)
      var trackingLoaded=false;
      function triggerTracking(){
        if(trackingLoaded)return;
        trackingLoaded=true;
        // Use requestIdleCallback if available, otherwise setTimeout
        if('requestIdleCallback' in window){
          requestIdleCallback(loadTrackingScripts,{timeout:2000});
        }else{
          setTimeout(loadTrackingScripts,100);
        }
      }

      // User interaction triggers - passive for better scroll performance
      ['scroll','click','touchstart','keydown'].forEach(function(e){
        document.addEventListener(e,triggerTracking,{once:true,passive:true});
      });

      // Fallback: load after 4 seconds if no interaction (more mobile-friendly)
      setTimeout(triggerTracking,4000);
    </script>
    <noscript>
      <img height="1" width="1" style="display:none"
           src="https://www.facebook.com/tr?id=823190717423799&ev=PageView&noscript=1" />
    </noscript>
  </body>
</html>

<style>
  body {
    font-family: "Poppins", sans-serif;
    overflow-x: hidden;
  }

  /* Skip to content link - visible only on focus for keyboard users */
  .skip-to-content {
    position: absolute;
    top: -100%;
    left: 50%;
    transform: translateX(-50%);
    z-index: 9999;
    padding: 1rem 2rem;
    background-color: #0f172a;
    color: #ffffff;
    font-weight: 600;
    text-decoration: none;
    border-radius: 0 0 0.5rem 0.5rem;
    transition: top 0.3s ease;
  }

  .skip-to-content:focus {
    top: 0;
    outline: 3px solid #06b6d4;
    outline-offset: 2px;
  }

  /* Remove default focus outline on main when focused via skip link */
  main:focus {
    outline: none;
  }
</style>
