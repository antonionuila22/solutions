---
import "../styles/global.css";
import "../styles/animations.css";
import { ClientRouter } from "astro:transitions";
import Navbar from "../components/NavbarAstro.astro";
import Footer from "../components/Footer.astro";
import WhatsAppWidget from "../components/WhatsAppWidget.astro";
import { createBreadcrumbSchemaFromUrl } from "../utils/schema";

// Props individuales
let {
  title,
  description,
  keywords,
  image,
  article,
  noindex,
  author,
  publishedTime,
  tags,
  categories,
  breadcrumbNames,
  canonicalOverride,
} = Astro.props;

// Valores por defecto mejorados
title =
  title ||
  "Codebrand - Digital Agency | Web Development, Automations, Design,  & Marketing";
description =
  description ||
  "Transform your business with Codebrand's expert web development, UI/UX design, and digital marketing services. Get custom solutions that drive real results. Contact us for a free consultation.";
keywords =
  keywords ||
  "web development agency, UI/UX design services, digital marketing agency, custom web development, mobile app development, SEO optimization, social media marketing, branding agency, e-commerce development, graphic design services";
image = image || "https://codebrand.us/og-image.svg";

// URL dinámica y mejoras SEO (permite override para páginas duplicadas)
const canonicalUrl =
  canonicalOverride || Astro.url?.href || "https://codebrand.us";
const siteName = "Codebrand Digital Agency";
const twitterHandle = "@codebrand_es";

// Format article dates for Open Graph
let formattedPublishedTime = "";
if (publishedTime) {
  if (publishedTime instanceof Date) {
    formattedPublishedTime = publishedTime.toISOString();
  } else if (typeof publishedTime === "string") {
    const dateObj = new Date(publishedTime);
    if (!isNaN(dateObj.getTime())) {
      formattedPublishedTime = dateObj.toISOString();
    }
  }
}

// Generate dynamic breadcrumbs based on current URL
const breadcrumbSchema = createBreadcrumbSchemaFromUrl(
  canonicalUrl,
  "https://codebrand.us",
  breadcrumbNames || {}
);
---

<!doctype html>
<html lang="en-US">
  <head>
    <!-- Essential Meta Tags -->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- SEO Meta Tags -->
    <title>{title}</title>
    <meta name="description" content={description} />
    <meta name="keywords" content={keywords} />
    <meta name="author" content="Codebrand Digital Agency" />
    <meta name="publisher" content="Codebrand" />

    <meta
      name="robots"
      content={noindex
        ? "noindex, nofollow"
        : "index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"}
    />
    <meta
      name="googlebot"
      content={noindex ? "noindex, nofollow" : "index, follow"}
    />
    <meta
      name="bingbot"
      content={noindex ? "noindex, nofollow" : "index, follow"}
    />

    <!-- Canonical and Alternative URLs -->
    <link rel="canonical" href={canonicalUrl} />
    <link rel="alternate" hreflang="en" href={canonicalUrl} />
    <link rel="alternate" hreflang="es" href={canonicalUrl} />
    <link rel="alternate" hreflang="x-default" href={canonicalUrl} />

    <!-- RSS Feed -->
    <link
      rel="alternate"
      type="application/rss+xml"
      title="Codebrand Blog RSS Feed"
      href="/rss.xml"
    />

    <!-- LLM Information for AI Assistants -->
    <link rel="author" href="/llms.txt" />
    <meta
      name="ai-content-declaration"
      content="This website contains information optimized for AI assistants. See /llms.txt for structured data."
    />

    <!-- Theme and Application -->
    <meta name="theme-color" content="#0D9488" />
    <meta name="color-scheme" content="light" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content="Codebrand" />
    <meta name="application-name" content="Codebrand" />
    <meta name="msapplication-TileColor" content="#0D9488" />

    <!-- Open Graph Protocol -->
    <meta property="og:type" content={article ? "article" : "website"} />
    <meta property="og:site_name" content={siteName} />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={image} />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta property="og:image:alt" content={title} />
    <meta property="og:url" content={canonicalUrl} />
    <meta property="og:locale" content="en_US" />
    <meta property="og:locale:alternate" content="es_ES" />
    <meta property="og:locale:alternate" content="es_MX" />
    <meta property="og:locale:alternate" content="es_HN" />

    {
      article && formattedPublishedTime && (
        <>
          <meta
            property="article:published_time"
            content={formattedPublishedTime}
          />
          {author && <meta property="article:author" content={author} />}
          {categories &&
            Array.isArray(categories) &&
            categories.map((cat: string) => (
              <meta property="article:section" content={cat} />
            ))}
          {tags &&
            Array.isArray(tags) &&
            tags.map((tag: string) => (
              <meta property="article:tag" content={tag} />
            ))}
        </>
      )
    }

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content={twitterHandle} />
    <meta name="twitter:creator" content={twitterHandle} />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content={image} />
    <meta name="twitter:image:alt" content={title} />

    <!-- Geo Tags - Primary market US, operations in Honduras -->
    <meta name="geo.region" content="US" />
    <meta name="geo.placename" content="United States" />
    <meta name="geo.position" content="15.5049;-88.0254" />
    <meta name="ICBM" content="15.5049, -88.0254" />

    <!-- Links and Resources -->
    <link rel="sitemap" href="/sitemap-index.xml" />
    <link rel="icon" type="image/svg+xml" href="/iconcodebrand.svg" />
    <link rel="apple-touch-icon" sizes="180x180" href="/iconcodebrand.svg" />
    <link rel="manifest" href="/manifest.json" />

    <!-- DNS Prefetch and Preconnect for Performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="dns-prefetch" href="https://www.googletagmanager.com" />
    <link rel="dns-prefetch" href="https://analytics.ahrefs.com" />
    <link rel="dns-prefetch" href="https://www.google.com" />
    <link rel="dns-prefetch" href="https://www.gstatic.com" />

    <!-- Preload Critical Resources for LCP optimization -->
    <link
      rel="preload"
      as="image"
      href="/photos/bannercodebrand.webp"
      fetchpriority="high"
    />

    <!-- Resource Hints for better loading -->
    <link rel="prefetch" href="/photos/section.webp" />
    <link rel="prefetch" href="/iconcodebrand.svg" />

    <!-- Preload font files directly for CLS optimization -->
    <link
      rel="preload"
      href="https://fonts.gstatic.com/s/poppins/v22/pxiEyp8kv8JHgFVrJJfecg.woff2"
      as="font"
      type="font/woff2"
      crossorigin
    />
    <link
      rel="preload"
      href="https://fonts.gstatic.com/s/poppins/v22/pxiByp8kv8JHgFVrLEj6Z1xlFQ.woff2"
      as="font"
      type="font/woff2"
      crossorigin
    />
    <link
      rel="preload"
      href="https://fonts.gstatic.com/s/poppins/v22/pxiByp8kv8JHgFVrLCz7Z1xlFQ.woff2"
      as="font"
      type="font/woff2"
      crossorigin
    />

    <!-- Fonts with optimized loading -->
    <link
      rel="preload"
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap"
      as="style"
      onload="this.onload=null;this.rel='stylesheet'"
    />
    <noscript>
      <link
        href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap"
        rel="stylesheet"
      />
    </noscript>

    <!-- Enhanced Structured Data -->
    <script type="application/ld+json" is:inline>
      {
        "@context": "https://schema.org",
        "@type": "ProfessionalService",
        "name": "Codebrand - Honduras Software Development Agency",
        "alternateName": [
          "Codebrand Solutions",
          "Codebrand Digital Agency",
          "Codebrand Honduras"
        ],
        "url": "https://codebrand.us",
        "logo": "https://codebrand.us/iconcodebrand.svg",
        "image": "https://codebrand.us/photos/bannercodebrand.webp",
        "description": "Leading software development agency in Honduras providing export-quality web development, mobile apps, and digital services to US businesses. 60% cost savings compared to US agencies with the same professional quality. Certified team (Udemy, Platzi, Adobe) with 500+ successful projects delivered to international clients.",
        "slogan": "Premium Web Development at 60% Lower Cost - Honduras to USA",
        "email": "info@codebrand.es",
        "telephone": "+504-3272-2973",
        "foundingDate": "2020",
        "numberOfEmployees": {
          "@type": "QuantitativeValue",
          "value": "25"
        },
        "address": {
          "@type": "PostalAddress",
          "streetAddress": "Calle 4, Avenida 11",
          "addressLocality": "San Pedro Sula",
          "addressRegion": "Cortés",
          "addressCountry": "HN",
          "postalCode": "21102"
        },
        "areaServed": [
          {
            "@type": "Country",
            "name": "United States"
          },
          {
            "@type": "Country",
            "name": "Honduras"
          },
          {
            "@type": "Country",
            "name": "Mexico"
          },
          {
            "@type": "Country",
            "name": "Guatemala"
          },
          {
            "@type": "Country",
            "name": "El Salvador"
          },
          {
            "@type": "Country",
            "name": "Costa Rica"
          },
          {
            "@type": "Country",
            "name": "Panama"
          },
          {
            "@type": "Country",
            "name": "Colombia"
          },
          {
            "@type": "Country",
            "name": "Spain"
          },
          {
            "@type": "Country",
            "name": "Chile"
          }
        ],
        "serviceArea": {
          "@type": "AdministrativeArea",
          "name": "United States and Latin America"
        },
        "priceRange": "$$$",
        "currenciesAccepted": "USD",
        "paymentAccepted": "Credit Card, Bank Transfer, PayPal",
        "openingHours": "Mo-Fr 09:00-18:00",
        "sameAs": [
          "https://www.linkedin.com/company/codebrand-es",
          "https://x.com/Codebrand_es",
          "https://www.facebook.com/codebrand",
          "https://www.facebook.com/people/Codebrand/100087321501519/"
        ],
        "knowsAbout": [
          "Web Development",
          "React Development",
          "Next.js Development",
          "Astro Development",
          "Node.js Development",
          "TypeScript Development",
          "UI/UX Design",
          "Mobile App Development",
          "iOS Development",
          "Android Development",
          "E-commerce Development",
          "Shopify Development",
          "Digital Marketing",
          "SEO Optimization",
          "Landing Page Design",
          "Branding",
          "Social Media Marketing",
          "Video Production",
          "3D Rendering",
          "Nearshore Development",
          "Offshore Development",
          "Software Export Services",
          "Honduras Software Development",
          "Central America Tech Services",
          "Cost-Effective Web Development",
          "Bilingual Software Teams"
        ],
        "knowsLanguage": ["English", "Spanish"],
        "award": [
          "Top Rated Web Development Agency Honduras 2025",
          "500+ Successful International Projects"
        ],
        "hasOfferCatalog": {
          "@type": "OfferCatalog",
          "name": "Software Development Services",
          "itemListElement": [
            {
              "@type": "Offer",
              "itemOffered": {
                "@type": "Service",
                "name": "Custom Web Development",
                "description": "Full-stack web development using React, Next.js, Astro, Node.js, and TypeScript. Professional quality at 60% less than US rates.",
                "provider": {
                  "@type": "Organization",
                  "name": "Codebrand"
                },
                "areaServed": "United States",
                "availableLanguage": ["English", "Spanish"]
              }
            },
            {
              "@type": "Offer",
              "itemOffered": {
                "@type": "Service",
                "name": "Mobile App Development",
                "description": "Native iOS and Android app development with cross-platform solutions using React Native and Flutter.",
                "provider": {
                  "@type": "Organization",
                  "name": "Codebrand"
                },
                "areaServed": "United States"
              }
            },
            {
              "@type": "Offer",
              "itemOffered": {
                "@type": "Service",
                "name": "E-commerce Development",
                "description": "Complete e-commerce solutions with Shopify, WooCommerce, and custom platforms. Payment gateway integration and inventory management.",
                "provider": {
                  "@type": "Organization",
                  "name": "Codebrand"
                },
                "areaServed": "United States"
              }
            },
            {
              "@type": "Offer",
              "itemOffered": {
                "@type": "Service",
                "name": "UI/UX Design Services",
                "description": "User-centered design services including wireframing, prototyping, and high-fidelity mockups using Figma and Adobe Creative Suite.",
                "provider": {
                  "@type": "Organization",
                  "name": "Codebrand"
                }
              }
            },
            {
              "@type": "Offer",
              "itemOffered": {
                "@type": "Service",
                "name": "SEO and Digital Marketing",
                "description": "Comprehensive SEO optimization, content marketing, social media management, and paid advertising campaigns.",
                "provider": {
                  "@type": "Organization",
                  "name": "Codebrand"
                }
              }
            },
            {
              "@type": "Offer",
              "itemOffered": {
                "@type": "Service",
                "name": "Nearshore Software Development",
                "description": "Honduras-based development team serving US businesses with timezone compatibility, bilingual communication, and 60% cost savings.",
                "provider": {
                  "@type": "Organization",
                  "name": "Codebrand"
                },
                "areaServed": "United States"
              }
            }
          ]
        },
        "aggregateRating": {
          "@type": "AggregateRating",
          "ratingValue": "4.9",
          "reviewCount": "127",
          "bestRating": "5",
          "worstRating": "1"
        },
        "brand": {
          "@type": "Brand",
          "name": "Codebrand",
          "slogan": "Export-Quality Software Development from Honduras to USA"
        },
        "employee": [
          {
            "@type": "OrganizationRole",
            "roleName": "Development Team",
            "description": "Certified developers with expertise in Udemy, Platzi, and Adobe certifications"
          }
        ],
        "makesOffer": [
          {
            "@type": "Offer",
            "name": "Free Consultation",
            "description": "Free initial consultation for US businesses seeking cost-effective software development",
            "price": "0",
            "priceCurrency": "USD"
          }
        ]
      }
    </script>

    <!-- Dynamic BreadcrumbList Schema -->
    <script
      type="application/ld+json"
      is:inline
      set:html={JSON.stringify(breadcrumbSchema)}
    />

    <!-- WebSite Schema with Search -->
    <script type="application/ld+json" is:inline>
      {
        "@context": "https://schema.org",
        "@type": "WebSite",
        "name": "Codebrand Digital Agency",
        "url": "https://codebrand.us",
        "potentialAction": {
          "@type": "SearchAction",
          "target": {
            "@type": "EntryPoint",
            "urlTemplate": "https://codebrand.us/search?q={search_term_string}"
          },
          "query-input": "required name=search_term_string"
        }
      }
    </script>

    <!-- Performance Hints -->
    <meta name="format-detection" content="telephone=no" />
    <meta name="skype_toolbar" content="skype_toolbar_parser_compatible" />

    <!-- Google Tag Manager + Analytics (carga diferida) -->
    <script is:inline>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}

      window.addEventListener('load', function() {
        setTimeout(function() {
          // GTM
          (function(w,d,s,l,i){w[l].push({'gtm.start':
          new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
          j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
          'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
          })(window,document,'script','dataLayer','GTM-TJCP2CWN');

          // GA4
          var ga = document.createElement('script');
          ga.async = true;
          ga.src = 'https://www.googletagmanager.com/gtag/js?id=G-T9HKBF45M9';
          document.head.appendChild(ga);
          gtag('js', new Date());
          gtag('config', 'G-T9HKBF45M9');
        }, 1500);
      });
    </script>

    <ClientRouter />
  </head>
  <body>
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TJCP2CWN"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->

    <Navbar />
    <main>
      <slot />
    </main>
    <Footer />
    <WhatsAppWidget />

    <script is:inline>
      window.addEventListener("load", function () {
        setTimeout(function () {
          var s = document.createElement("script");
          s.src = "https://analytics.ahrefs.com/analytics.js";
          s.setAttribute("data-key", "JekMc+iUh7qv8b6i7VSQFw");
          s.async = true;
          document.head.appendChild(s);
        }, 2000);
      });
    </script>
  </body>
</html>

<style>
  body {
    font-family: "Poppins", sans-serif;
  }
</style>
