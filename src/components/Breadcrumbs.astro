---
interface BreadcrumbItem {
  name: string;
  href: string;
}

interface Props {
  items?: BreadcrumbItem[];
  variant?: "light" | "dark" | "transparent";
  class?: string;
}

const { items, variant = "light", class: className } = Astro.props;

// Generate breadcrumbs from URL if not provided
function generateBreadcrumbs(url: URL): BreadcrumbItem[] {
  const path = url.pathname;

  // Don't show breadcrumbs on homepage
  if (path === "/" || path === "") {
    return [];
  }

  const segments = path.split("/").filter(Boolean);
  const breadcrumbs: BreadcrumbItem[] = [{ name: "Home", href: "/" }];

  // Map of URL segments to display names
  const nameMap: Record<string, string> = {
    "web-development": "Web Development",
    "web-design": "Web Design",
    "branding": "Branding",
    "seo": "SEO Services",
    "digital-marketing": "Digital Marketing",
    "e-commerce": "E-commerce",
    "landing-pages": "Landing Pages",
    "outsourcing-development": "Outsourcing Development",
    "outsourcing-design": "Outsourcing Design",
    "blog": "Blog",
    "projects": "Projects",
    "contact": "Contact",
    "about": "About",
    "locations": "Locations",
    "regions": "Regions",
    "industries": "Industries",
    "countryareas": "Service Areas",
    "real-estate": "Real Estate",
    "restaurants": "Restaurants",
    "healthcare": "Healthcare",
    "ecommerce": "E-commerce",
    "law-firms": "Law Firms",
    "fitness": "Fitness",
    "travel-agency": "Travel Agency",
    "construction": "Construction",
    "content-creators": "Content Creators",
    "automotive": "Automotive",
    "services": "Services",
  };

  let currentPath = "";
  segments.forEach((segment, index) => {
    currentPath += `/${segment}`;
    const isLast = index === segments.length - 1;

    // Try to get display name from map, otherwise format the segment
    let displayName = nameMap[segment] ||
      segment
        .split("-")
        .map(word => word.charAt(0).toUpperCase() + word.slice(1))
        .join(" ");

    // Truncate long names (like blog post slugs)
    if (displayName.length > 40) {
      displayName = displayName.substring(0, 37) + "...";
    }

    breadcrumbs.push({
      name: displayName,
      href: isLast ? "" : currentPath,
    });
  });

  return breadcrumbs;
}

const breadcrumbItems = items || generateBreadcrumbs(Astro.url);
const showBreadcrumbs = breadcrumbItems.length > 1;

// Variant styles
const variantStyles = {
  light: {
    container: "bg-gradient-to-r from-cyan-50 to-orange-50 border-b border-cyan-100",
    text: "text-cyan-700",
    textHover: "hover:text-orange-600",
    textActive: "text-cyan-900 font-semibold",
    separator: "text-cyan-400",
    icon: "text-cyan-500",
  },
  dark: {
    container: "bg-cyan-900/10 backdrop-blur-sm border-b border-cyan-800/20",
    text: "text-cyan-100",
    textHover: "hover:text-orange-400",
    textActive: "text-white font-semibold",
    separator: "text-cyan-500",
    icon: "text-cyan-400",
  },
  transparent: {
    container: "bg-transparent",
    text: "text-gray-600",
    textHover: "hover:text-orange-600",
    textActive: "text-cyan-900 font-semibold",
    separator: "text-gray-400",
    icon: "text-gray-500",
  },
};

const styles = variantStyles[variant];
---

{showBreadcrumbs && (
  <nav
    aria-label="Breadcrumb"
    class:list={[
      "font-poppins",
      styles.container,
      className
    ]}
  >
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <ol class="flex items-center gap-2 py-4 text-sm overflow-x-auto whitespace-nowrap">
        {breadcrumbItems.map((item, index) => {
          const isLast = index === breadcrumbItems.length - 1;
          return (
            <li class="flex items-center">
              {index === 0 && (
                <svg
                  class:list={["w-4 h-4 mr-1.5 flex-shrink-0", styles.icon]}
                  fill="currentColor"
                  viewBox="0 0 20 20"
                  aria-hidden="true"
                >
                  <path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z" />
                </svg>
              )}
              {index > 0 && (
                <svg
                  class:list={["w-4 h-4 mx-2 flex-shrink-0", styles.separator]}
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                  aria-hidden="true"
                >
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                </svg>
              )}
              {isLast ? (
                <span
                  class:list={[styles.textActive]}
                  aria-current="page"
                >
                  {item.name}
                </span>
              ) : (
                <a
                  href={item.href}
                  class:list={[
                    "transition-colors duration-200",
                    styles.text,
                    styles.textHover
                  ]}
                >
                  {item.name}
                </a>
              )}
            </li>
          );
        })}
      </ol>
    </div>
  </nav>
)}
